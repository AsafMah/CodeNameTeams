<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Codenames Team Chooser</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 40px auto;
            max-width: 650px;
            line-height: 1.6;
            font-size: 18px;
            padding: 0 10px
        }

        h1,
        h2,
        h3 {
            line-height: 1.2
        }

        .pressed {
            background-color: yellowgreen;
        }

        table,
        thead,
        th {
            border: 1px solid black;
            text-align: center;
        }

        .red {
            background-color: lightcoral;
        }

        .blue {
            background-color: lightskyblue;
        }

        .spymaster {
            font-weight: bold;
        }

        .wrapper {
            display: inline-block;
            border: 1px black solid;
            margin: 3px;
            padding: 3px;
        }
    </style>
</head>

<body>
    <h1>Codenames Team Chooser</h1>
    <div id="people"></div>
    <div><button onclick="makeTeams()">Make Teams</button></div>
    <div>
        <table id="table">
            <thead>
                <th class="red">Red Team</th>
                <th class="blue">Blue Team</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <button onclick="updateNames()">Update Names</button>
    <div>
        <textarea id="names" rows=30>
AmitSh
Ariel
Asaf
Boaz
Keren
Lea
Nir
Ohad
Ran
Vladik
Yihezkel
Yochai
        </textarea>
    </div>
</body>
<script>
    let people = {};
    function updateNames() {
        const peopleNames = document.getElementById("names").value.trim().split("\n");
        const peopleDiv = document.getElementById("people");
        peopleDiv.innerHTML = "";
        people = {};

        for (const person of peopleNames) {
            people[person] = { selected: false, canBeSpymaster: true};

            let wrapper = document.createElement("div");
            wrapper.classList.add("wrapper");

            let canBeSpymaster = document.createElement("input");
            canBeSpymaster.type = "checkbox";
            canBeSpymaster.checked = true;
            canBeSpymaster.disabled = true;
            canBeSpymaster.onchange = function(){
                people[person].canBeSpymaster = this.checked;
            }
            let canBelabel = document.createElement("canBelabel");
            canBelabel.innerText = "SM Pool"

            let nameButton = document.createElement("button");
            nameButton.innerText = person;
            nameButton.onclick = function () {
                this.classList.toggle("pressed");
                people[person].selected = !people[person].selected;
                canBeSpymaster.disabled = !people[person].selected;
            };

            wrapper.appendChild(nameButton);
            wrapper.appendChild(canBeSpymaster);
            wrapper.appendChild(canBelabel);
            peopleDiv.appendChild(wrapper);
        }
    }
    function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function makeTeams() {
        var selectedPeopleRaw = []
        for (const p in people) {
            if (people[p].selected)
                selectedPeopleRaw.push(p)
        }
        shuffle(selectedPeopleRaw);

        const selectedPeople = [];
        let redTeam = [];
        let blueTeam = [];
        for (const person of selectedPeopleRaw) {
            if (people[person].canBeSpymaster)
            {
                if (redTeam.length == 0) 
                {
                    redTeam.push(person);
                    continue;
                }
                else if (blueTeam.length == 0)
                {
                    blueTeam.push(person);
                    continue;
                }
            }

            selectedPeople.push(person);
        }

        teamSize = selectedPeople.length / 2;

        if (teamSize != Math.floor(teamSize)) {
            teamSize = Math.floor(teamSize);

            //if there is an even number we don't always want the red team to be bigger
            if (Math.random() > 0.5) {
                teamSize += 1;
            }
        }

        redTeam = redTeam.concat(selectedPeople.slice(0, teamSize));
        blueTeam = blueTeam.concat(selectedPeople.slice(teamSize, selectedPeople.length));
        const body = document.createElement("tbody");

        for (let i = 0; i < selectedPeopleRaw.length / 2; i++) {
            const row = body.insertRow(i);
            const redCell = row.insertCell(0);
            redCell.innerText = redTeam[i] ?? "";
            redCell.classList.add("red");
            const blueCell = row.insertCell(1);
            blueCell.innerText = blueTeam[i] ?? "";
            blueCell.classList.add("blue");

            if (i == 0) {
                const makeSpymaster = (t) => {
                    t.innerText += " - Spymaster";
                    t.classList.add("spymaster");
                }
                makeSpymaster(redCell);
                makeSpymaster(blueCell);
            }
        }

        var table = document.getElementById("table");
        table.replaceChild(body, table.querySelector("tbody"));
    }

    updateNames(); 
</script>

</html>
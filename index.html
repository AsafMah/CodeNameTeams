<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Spyfall Team Chooser</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }
        .pressed {
            background-color: yellowgreen;
        }

        table,
        thead,
        th {
            border: 1px solid black;
            text-align: center;
        }

        .red {
            background-color: lightcoral;
        }

        .blue {
            background-color: lightskyblue;
        }

        .spymaster {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Spyfall Team Chooser</h1>
    <div id="people"></div>
    <div><button onclick="makeTeams()">Make Teams</button></div>
    <div>
        <table id="table">
            <thead>
                <th class="red">Red Team</th>
                <th class="blue">Blue Team</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <button onclick="updateNames()">Update Names</button>
    <div>
        <textarea id="names" rows=30>
AmitSh
Ariel
Asaf
Boaz
Keren
Lea
Nir
Ohad
Ran
Vladik
Yihezkel
Yochai
        </textarea>
    </div>
</body>
<script>
    let people = {};
    function updateNames() {
        const peopleNames = document.getElementById("names").value.trim().split("\n");
        const peopleDiv = document.getElementById("people");
        peopleDiv.innerHTML = "";
        people = {};

        for (const person of peopleNames) {
            people[person] = false
            let button = document.createElement("button");
            button.innerText = person;
            button.onclick = function () {
                this.classList.toggle("pressed");
                people[person] = !people[person];
            };
            peopleDiv.appendChild(button);
        }
    }
    function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function makeTeams() {
        var selectedPeople = []
        for (const p in people) {
            if (people[p])
                selectedPeople.push(p)
        }
        shuffle(selectedPeople);

        teamSize = selectedPeople.length / 2;

        if (teamSize != Math.floor(teamSize)) {
            teamSize = Math.floor(teamSize);

            //if there is an even number we don't always want the red team to be bigger
            if (Math.random() > 0.5) {
                teamSize += 1;
            }
        }

        const redTeam = selectedPeople.slice(0, teamSize)
        const blueTeam = selectedPeople.slice(teamSize, selectedPeople.length)
        const body = document.createElement("tbody");

        for (let i = 0; i < selectedPeople.length / 2; i++) {
            const row = body.insertRow(i);
            const redCell = row.insertCell(0);
            redCell.innerText = redTeam[i] ?? "";
            redCell.classList.add("red");
            const blueCell = row.insertCell(1);
            blueCell.innerText = blueTeam[i] ?? "";
            blueCell.classList.add("blue");

            if (i == 0) {
                const makeSpymaster = (t) => {
                    t.innerText += " - Spymaster";
                    t.classList.add("spymaster");
                }
                makeSpymaster(redCell);
                makeSpymaster(blueCell);
            }
        }

        var table = document.getElementById("table");
        table.replaceChild(body, table.querySelector("tbody"));
    }

    updateNames(); 
</script>

</html>